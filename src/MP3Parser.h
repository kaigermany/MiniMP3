
#ifndef MP3Parser_H
#define MP3Parser_H

#include <Arduino.h>   // Core Arduino functions

#include "LinkedList.h"
#include "ReadableBlock.h"
#include "printlnLogging.h"



#define MP3_ERRORCODE_NONE 0								//success.
#define MP3_ERRORCODE_UNKNOWN 1
#define MP3_ERRORCODE_INSUFFICENT_MEMORY 2
#define MP3_ERRORCODE_INVALID_MPEG_VERSION_CONFIG 3
#define MP3_ERRORCODE_END_OF_INPUT_BUFFER_REACHED 4			//abborted decoding: not enough data.
#define MP3_ERRORCODE_NOT_LAYER3_AUDIO 5
#define MP3_ERRORCODE_INVALID_SAMPLEINGFREQUENCY_CONFIG 6
#define MP3_ERRORCODE_BUFFER_HAS_NO_STARTSEQUENCE 7			//abboarted: can find the typical start sequence in buffer.
#define MP3_ERRORCODE_MISSING_HEADER 8
#define MP3_ERRORCODE_NEGATIVE_DISCARD 9
#define MP3_ERRORCODE_ILLEGAL_SUBBAND_ALLOCATION 10



#define MAX_FRAME_DATA_SIZE 1420
#define MAX_REVERSE_LOOKUP_DATA_SIZE 511
#define MAX_DATAPOOL_SIZE MAX_REVERSE_LOOKUP_DATA_SIZE+MAX_FRAME_DATA_SIZE

#define SS_LIMIT 18
#define SB_LIMIT 32

#define MPEG2_LSF 0
#define JOINT_STEREO 1
#define MPEG25_LSF 2
#define SINGLE_CHANNEL 3

#define MPEG1 1




const int MP3_frequencies[3][4] = { { 22050, 24000, 16000, 1 }, { 44100, 48000, 32000, 1 }, { 11025, 12000, 8000, 1 } };
const int MP3_bitrates[2][16] = { 
			{0, 8000, 16000, 24000, 32000, 40000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 144000, 160000, 0},
			{0, 32000, 40000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 160000, 192000, 224000, 256000, 320000, 0}
};
const int MP3_bitrates_extended[2][2][16] = {
	{
		{0, 32000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 144000, 160000, 176000, 192000 ,224000, 256000, 0},
		{0, 8000, 16000, 24000, 32000, 40000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 144000, 160000, 0}
	},{
		{0, 32000, 64000, 96000, 128000, 160000, 192000, 224000, 256000, 288000, 320000, 352000, 384000, 416000, 448000, 0},
		{0, 32000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 160000, 192000, 224000, 256000, 320000, 384000, 0}
	}
};
const int t_43_length = 8192;
//const int SINGLE_CHANNEL = 3;
const int MP3_HEADERFRAME_SIZE = 4;

const int BITRATE_LAYER_III[15] = { 0, 32000, 40000, 48000, 56000, 64000, 80000, 96000, 112000, 128000, 160000, 192000, 224000, 256000, 320000 };
const int SAMPLING_FREQUENCY[3] = { 44100, 48000, 32000 };


const int MXOFF = 250;

const unsigned char ValTab_dummy[1][2] = {{0,0}};	// dummy

const unsigned char ValTab1[7][2] = {
	{2,1},{0,0},{2,1},{0,16},{2,1},{0,1},{0,17}
};

const unsigned char ValTab2[17][2] = {
	{2,1},{0,0},{4,1},{2,1},{0,16},{0,1},{2,1},{0,17},{4,1},{2,1},
	{0,32},{0,33},{2,1},{0,18},{2,1},{0,2},{0,34}
};

const unsigned char ValTab3[17][2] = {
	{4,1},{2,1},{0,0},{0,1},{2,1},{0,17},{2,1},{0,16},{4,1},{2,1},
	{0,32},{0,33},{2,1},{0,18},{2,1},{0,2},{0,34},
};


const unsigned char ValTab5[31][2] = {
	{2,1},{0,0},{4,1},{2,1},{0,16},{0,1},{2,1},{0,17},{8,1},{4,1},
	{2,1},{0,32},{0,2},{2,1},{0,33},{0,18},{8,1},{4,1},{2,1},{0,34},
	{0,48},{2,1},{0,3},{0,19},{2,1},{0,49},{2,1},{0,50},{2,1},{0,35},
	{0,51},
};

const unsigned char ValTab6[31][2] = {
	{6,1},{4,1},{2,1},{0,0},{0,16},{0,17},{6,1},{2,1},{0,1},{2,1},
	{0,32},{0,33},{6,1},{2,1},{0,18},{2,1},{0,2},{0,34},{4,1},{2,1},
	{0,49},{0,19},{4,1},{2,1},{0,48},{0,50},{2,1},{0,35},{2,1},{0,3},
	{0,51},
};

const unsigned char ValTab7[71][2] = {
	{2,1},{0,0},{4,1},{2,1},{0,16},{0,1},{8,1},{2,1},{0,17},{4,1},
	{2,1},{0,32},{0,2},{0,33},{18,1},{6,1},{2,1},{0,18},{2,1},{0,34},
	{0,48},{4,1},{2,1},{0,49},{0,19},{4,1},{2,1},{0,3},{0,50},{2,1},
	{0,35},{0,4},{10,1},{4,1},{2,1},{0,64},{0,65},{2,1},{0,20},{2,1},
	{0,66},{0,36},{12,1},{6,1},{4,1},{2,1},{0,51},{0,67},{0,80},{4,1},
	{2,1},{0,52},{0,5},{0,81},{6,1},{2,1},{0,21},{2,1},{0,82},{0,37},
	{4,1},{2,1},{0,68},{0,53},{4,1},{2,1},{0,83},{0,84},{2,1},{0,69},
	{0,85},
};

const unsigned char ValTab8[71][2] = {
	{6,1},{2,1},{0,0},{2,1},{0,16},{0,1},{2,1},{0,17},{4,1},{2,1},
	{0,33},{0,18},{14,1},{4,1},{2,1},{0,32},{0,2},{2,1},{0,34},{4,1},
	{2,1},{0,48},{0,3},{2,1},{0,49},{0,19},{14,1},{8,1},{4,1},{2,1},
	{0,50},{0,35},{2,1},{0,64},{0,4},{2,1},{0,65},{2,1},{0,20},{0,66},
	{12,1},{6,1},{2,1},{0,36},{2,1},{0,51},{0,80},{4,1},{2,1},{0,67},
	{0,52},{0,81},{6,1},{2,1},{0,21},{2,1},{0,5},{0,82},{6,1},{2,1},
	{0,37},{2,1},{0,68},{0,53},{2,1},{0,83},{2,1},{0,69},{2,1},{0,84},
	{0,85},
};

const unsigned char ValTab9[71][2] = {
	{8,1},{4,1},{2,1},{0,0},{0,16},{2,1},{0,1},{0,17},{10,1},{4,1},
	{2,1},{0,32},{0,33},{2,1},{0,18},{2,1},{0,2},{0,34},{12,1},{6,1},
	{4,1},{2,1},{0,48},{0,3},{0,49},{2,1},{0,19},{2,1},{0,50},{0,35},
	{12,1},{4,1},{2,1},{0,65},{0,20},{4,1},{2,1},{0,64},{0,51},{2,1},
	{0,66},{0,36},{10,1},{6,1},{4,1},{2,1},{0,4},{0,80},{0,67},{2,1},
	{0,52},{0,81},{8,1},{4,1},{2,1},{0,21},{0,82},{2,1},{0,37},{0,68},
	{6,1},{4,1},{2,1},{0,5},{0,84},{0,83},{2,1},{0,53},{2,1},{0,69},
	{0,85},
};

const unsigned char ValTab10[127][2] = {
	{2,1},{0,0},{4,1},{2,1},{0,16},{0,1},{10,1},{2,1},{0,17},{4,1},
	{2,1},{0,32},{0,2},{2,1},{0,33},{0,18},{28,1},{8,1},{4,1},{2,1},
	{0,34},{0,48},{2,1},{0,49},{0,19},{8,1},{4,1},{2,1},{0,3},{0,50},
	{2,1},{0,35},{0,64},{4,1},{2,1},{0,65},{0,20},{4,1},{2,1},{0,4},
	{0,51},{2,1},{0,66},{0,36},{28,1},{10,1},{6,1},{4,1},{2,1},{0,80},
	{0,5},{0,96},{2,1},{0,97},{0,22},{12,1},{6,1},{4,1},{2,1},{0,67},
	{0,52},{0,81},{2,1},{0,21},{2,1},{0,82},{0,37},{4,1},{2,1},{0,38},
	{0,54},{0,113},{20,1},{8,1},{2,1},{0,23},{4,1},{2,1},{0,68},{0,83},
	{0,6},{6,1},{4,1},{2,1},{0,53},{0,69},{0,98},{2,1},{0,112},{2,1},
	{0,7},{0,100},{14,1},{4,1},{2,1},{0,114},{0,39},{6,1},{2,1},{0,99},
	{2,1},{0,84},{0,85},{2,1},{0,70},{0,115},{8,1},{4,1},{2,1},{0,55},
	{0,101},{2,1},{0,86},{0,116},{6,1},{2,1},{0,71},{2,1},{0,102},{0,117},
	{4,1},{2,1},{0,87},{0,118},{2,1},{0,103},{0,119},
};

const unsigned char ValTab11[127][2] = {
	{6,1},{2,1},{0,0},{2,1},{0,16},{0,1},{8,1},{2,1},{0,17},{4,1},
	{2,1},{0,32},{0,2},{0,18},{24,1},{8,1},{2,1},{0,33},{2,1},{0,34},
	{2,1},{0,48},{0,3},{4,1},{2,1},{0,49},{0,19},{4,1},{2,1},{0,50},
	{0,35},{4,1},{2,1},{0,64},{0,4},{2,1},{0,65},{0,20},{30,1},{16,1},
	{10,1},{4,1},{2,1},{0,66},{0,36},{4,1},{2,1},{0,51},{0,67},{0,80},
	{4,1},{2,1},{0,52},{0,81},{0,97},{6,1},{2,1},{0,22},{2,1},{0,6},
	{0,38},{2,1},{0,98},{2,1},{0,21},{2,1},{0,5},{0,82},{16,1},{10,1},
	{6,1},{4,1},{2,1},{0,37},{0,68},{0,96},{2,1},{0,99},{0,54},{4,1},
	{2,1},{0,112},{0,23},{0,113},{16,1},{6,1},{4,1},{2,1},{0,7},{0,100},
	{0,114},{2,1},{0,39},{4,1},{2,1},{0,83},{0,53},{2,1},{0,84},{0,69},
	{10,1},{4,1},{2,1},{0,70},{0,115},{2,1},{0,55},{2,1},{0,101},{0,86},
	{10,1},{6,1},{4,1},{2,1},{0,85},{0,87},{0,116},{2,1},{0,71},{0,102},
	{4,1},{2,1},{0,117},{0,118},{2,1},{0,103},{0,119},
};

const unsigned char ValTab12[127][2] = {
	{12,1},{4,1},{2,1},{0,16},{0,1},{2,1},{0,17},{2,1},{0,0},{2,1},
	{0,32},{0,2},{16,1},{4,1},{2,1},{0,33},{0,18},{4,1},{2,1},{0,34},
	{0,49},{2,1},{0,19},{2,1},{0,48},{2,1},{0,3},{0,64},{26,1},{8,1},
	{4,1},{2,1},{0,50},{0,35},{2,1},{0,65},{0,51},{10,1},{4,1},{2,1},
	{0,20},{0,66},{2,1},{0,36},{2,1},{0,4},{0,80},{4,1},{2,1},{0,67},
	{0,52},{2,1},{0,81},{0,21},{28,1},{14,1},{8,1},{4,1},{2,1},{0,82},
	{0,37},{2,1},{0,83},{0,53},{4,1},{2,1},{0,96},{0,22},{0,97},{4,1},
	{2,1},{0,98},{0,38},{6,1},{4,1},{2,1},{0,5},{0,6},{0,68},{2,1},
	{0,84},{0,69},{18,1},{10,1},{4,1},{2,1},{0,99},{0,54},{4,1},{2,1},
	{0,112},{0,7},{0,113},{4,1},{2,1},{0,23},{0,100},{2,1},{0,70},{0,114},
	{10,1},{6,1},{2,1},{0,39},{2,1},{0,85},{0,115},{2,1},{0,55},{0,86},
	{8,1},{4,1},{2,1},{0,101},{0,116},{2,1},{0,71},{0,102},{4,1},{2,1},
	{0,117},{0,87},{2,1},{0,118},{2,1},{0,103},{0,119},
};

const unsigned char ValTab13[511][2] = {
	{2,1},{0,0},{6,1},{2,1},{0,16},{2,1},{0,1},{0,17},{28,1},{8,1},
	{4,1},{2,1},{0,32},{0,2},{2,1},{0,33},{0,18},{8,1},{4,1},{2,1},
	{0,34},{0,48},{2,1},{0,3},{0,49},{6,1},{2,1},{0,19},{2,1},{0,50},
	{0,35},{4,1},{2,1},{0,64},{0,4},{0,65},{70,1},{28,1},{14,1},{6,1},
	{2,1},{0,20},{2,1},{0,51},{0,66},{4,1},{2,1},{0,36},{0,80},{2,1},
	{0,67},{0,52},{4,1},{2,1},{0,81},{0,21},{4,1},{2,1},{0,5},{0,82},
	{2,1},{0,37},{2,1},{0,68},{0,83},{14,1},{8,1},{4,1},{2,1},{0,96},
	{0,6},{2,1},{0,97},{0,22},{4,1},{2,1},{0,128},{0,8},{0,129},{16,1},
	{8,1},{4,1},{2,1},{0,53},{0,98},{2,1},{0,38},{0,84},{4,1},{2,1},
	{0,69},{0,99},{2,1},{0,54},{0,112},{6,1},{4,1},{2,1},{0,7},{0,85},
	{0,113},{2,1},{0,23},{2,1},{0,39},{0,55},{72,1},{24,1},{12,1},{4,1},
	{2,1},{0,24},{0,130},{2,1},{0,40},{4,1},{2,1},{0,100},{0,70},{0,114},
	{8,1},{4,1},{2,1},{0,132},{0,72},{2,1},{0,144},{0,9},{2,1},{0,145},
	{0,25},{24,1},{14,1},{8,1},{4,1},{2,1},{0,115},{0,101},{2,1},{0,86},
	{0,116},{4,1},{2,1},{0,71},{0,102},{0,131},{6,1},{2,1},{0,56},{2,1},
	{0,117},{0,87},{2,1},{0,146},{0,41},{14,1},{8,1},{4,1},{2,1},{0,103},
	{0,133},{2,1},{0,88},{0,57},{2,1},{0,147},{2,1},{0,73},{0,134},{6,1},
	{2,1},{0,160},{2,1},{0,104},{0,10},{2,1},{0,161},{0,26},{68,1},{24,1},
	{12,1},{4,1},{2,1},{0,162},{0,42},{4,1},{2,1},{0,149},{0,89},{2,1},
	{0,163},{0,58},{8,1},{4,1},{2,1},{0,74},{0,150},{2,1},{0,176},{0,11},
	{2,1},{0,177},{0,27},{20,1},{8,1},{2,1},{0,178},{4,1},{2,1},{0,118},
	{0,119},{0,148},{6,1},{4,1},{2,1},{0,135},{0,120},{0,164},{4,1},{2,1},
	{0,105},{0,165},{0,43},{12,1},{6,1},{4,1},{2,1},{0,90},{0,136},{0,179},
	{2,1},{0,59},{2,1},{0,121},{0,166},{6,1},{4,1},{2,1},{0,106},{0,180},
	{0,192},{4,1},{2,1},{0,12},{0,152},{0,193},{60,1},{22,1},{10,1},{6,1},
	{2,1},{0,28},{2,1},{0,137},{0,181},{2,1},{0,91},{0,194},{4,1},{2,1},
	{0,44},{0,60},{4,1},{2,1},{0,182},{0,107},{2,1},{0,196},{0,76},{16,1},
	{8,1},{4,1},{2,1},{0,168},{0,138},{2,1},{0,208},{0,13},{2,1},{0,209},
	{2,1},{0,75},{2,1},{0,151},{0,167},{12,1},{6,1},{2,1},{0,195},{2,1},
	{0,122},{0,153},{4,1},{2,1},{0,197},{0,92},{0,183},{4,1},{2,1},{0,29},
	{0,210},{2,1},{0,45},{2,1},{0,123},{0,211},{52,1},{28,1},{12,1},{4,1},
	{2,1},{0,61},{0,198},{4,1},{2,1},{0,108},{0,169},{2,1},{0,154},{0,212},
	{8,1},{4,1},{2,1},{0,184},{0,139},{2,1},{0,77},{0,199},{4,1},{2,1},
	{0,124},{0,213},{2,1},{0,93},{0,224},{10,1},{4,1},{2,1},{0,225},{0,30},
	{4,1},{2,1},{0,14},{0,46},{0,226},{8,1},{4,1},{2,1},{0,227},{0,109},
	{2,1},{0,140},{0,228},{4,1},{2,1},{0,229},{0,186},{0,240},{38,1},{16,1},
	{4,1},{2,1},{0,241},{0,31},{6,1},{4,1},{2,1},{0,170},{0,155},{0,185},
	{2,1},{0,62},{2,1},{0,214},{0,200},{12,1},{6,1},{2,1},{0,78},{2,1},
	{0,215},{0,125},{2,1},{0,171},{2,1},{0,94},{0,201},{6,1},{2,1},{0,15},
	{2,1},{0,156},{0,110},{2,1},{0,242},{0,47},{32,1},{16,1},{6,1},{4,1},
	{2,1},{0,216},{0,141},{0,63},{6,1},{2,1},{0,243},{2,1},{0,230},{0,202},
	{2,1},{0,244},{0,79},{8,1},{4,1},{2,1},{0,187},{0,172},{2,1},{0,231},
	{0,245},{4,1},{2,1},{0,217},{0,157},{2,1},{0,95},{0,232},{30,1},{12,1},
	{6,1},{2,1},{0,111},{2,1},{0,246},{0,203},{4,1},{2,1},{0,188},{0,173},
	{0,218},{8,1},{2,1},{0,247},{4,1},{2,1},{0,126},{0,127},{0,142},{6,1},
	{4,1},{2,1},{0,158},{0,174},{0,204},{2,1},{0,248},{0,143},{18,1},{8,1},
	{4,1},{2,1},{0,219},{0,189},{2,1},{0,234},{0,249},{4,1},{2,1},{0,159},
	{0,235},{2,1},{0,190},{2,1},{0,205},{0,250},{14,1},{4,1},{2,1},{0,221},
	{0,236},{6,1},{4,1},{2,1},{0,233},{0,175},{0,220},{2,1},{0,206},{0,251},
	{8,1},{4,1},{2,1},{0,191},{0,222},{2,1},{0,207},{0,238},{4,1},{2,1},
	{0,223},{0,239},{2,1},{0,255},{2,1},{0,237},{2,1},{0,253},{2,1},{0,252},
	{0,254},
};

const unsigned char ValTab15[511][2] = {
	{16,1},{6,1},{2,1},{0,0},{2,1},{0,16},{0,1},{2,1},{0,17},{4,1},
	{2,1},{0,32},{0,2},{2,1},{0,33},{0,18},{50,1},{16,1},{6,1},{2,1},
	{0,34},{2,1},{0,48},{0,49},{6,1},{2,1},{0,19},{2,1},{0,3},{0,64},
	{2,1},{0,50},{0,35},{14,1},{6,1},{4,1},{2,1},{0,4},{0,20},{0,65},
	{4,1},{2,1},{0,51},{0,66},{2,1},{0,36},{0,67},{10,1},{6,1},{2,1},
	{0,52},{2,1},{0,80},{0,5},{2,1},{0,81},{0,21},{4,1},{2,1},{0,82},
	{0,37},{4,1},{2,1},{0,68},{0,83},{0,97},{90,1},{36,1},{18,1},{10,1},
	{6,1},{2,1},{0,53},{2,1},{0,96},{0,6},{2,1},{0,22},{0,98},{4,1},
	{2,1},{0,38},{0,84},{2,1},{0,69},{0,99},{10,1},{6,1},{2,1},{0,54},
	{2,1},{0,112},{0,7},{2,1},{0,113},{0,85},{4,1},{2,1},{0,23},{0,100},
	{2,1},{0,114},{0,39},{24,1},{16,1},{8,1},{4,1},{2,1},{0,70},{0,115},
	{2,1},{0,55},{0,101},{4,1},{2,1},{0,86},{0,128},{2,1},{0,8},{0,116},
	{4,1},{2,1},{0,129},{0,24},{2,1},{0,130},{0,40},{16,1},{8,1},{4,1},
	{2,1},{0,71},{0,102},{2,1},{0,131},{0,56},{4,1},{2,1},{0,117},{0,87},
	{2,1},{0,132},{0,72},{6,1},{4,1},{2,1},{0,144},{0,25},{0,145},{4,1},
	{2,1},{0,146},{0,118},{2,1},{0,103},{0,41},{92,1},{36,1},{18,1},{10,1},
	{4,1},{2,1},{0,133},{0,88},{4,1},{2,1},{0,9},{0,119},{0,147},{4,1},
	{2,1},{0,57},{0,148},{2,1},{0,73},{0,134},{10,1},{6,1},{2,1},{0,104},
	{2,1},{0,160},{0,10},{2,1},{0,161},{0,26},{4,1},{2,1},{0,162},{0,42},
	{2,1},{0,149},{0,89},{26,1},{14,1},{6,1},{2,1},{0,163},{2,1},{0,58},
	{0,135},{4,1},{2,1},{0,120},{0,164},{2,1},{0,74},{0,150},{6,1},{4,1},
	{2,1},{0,105},{0,176},{0,177},{4,1},{2,1},{0,27},{0,165},{0,178},{14,1},
	{8,1},{4,1},{2,1},{0,90},{0,43},{2,1},{0,136},{0,151},{2,1},{0,179},
	{2,1},{0,121},{0,59},{8,1},{4,1},{2,1},{0,106},{0,180},{2,1},{0,75},
	{0,193},{4,1},{2,1},{0,152},{0,137},{2,1},{0,28},{0,181},{80,1},{34,1},
	{16,1},{6,1},{4,1},{2,1},{0,91},{0,44},{0,194},{6,1},{4,1},{2,1},
	{0,11},{0,192},{0,166},{2,1},{0,167},{0,122},{10,1},{4,1},{2,1},{0,195},
	{0,60},{4,1},{2,1},{0,12},{0,153},{0,182},{4,1},{2,1},{0,107},{0,196},
	{2,1},{0,76},{0,168},{20,1},{10,1},{4,1},{2,1},{0,138},{0,197},{4,1},
	{2,1},{0,208},{0,92},{0,209},{4,1},{2,1},{0,183},{0,123},{2,1},{0,29},
	{2,1},{0,13},{0,45},{12,1},{4,1},{2,1},{0,210},{0,211},{4,1},{2,1},
	{0,61},{0,198},{2,1},{0,108},{0,169},{6,1},{4,1},{2,1},{0,154},{0,184},
	{0,212},{4,1},{2,1},{0,139},{0,77},{2,1},{0,199},{0,124},{68,1},{34,1},
	{18,1},{10,1},{4,1},{2,1},{0,213},{0,93},{4,1},{2,1},{0,224},{0,14},
	{0,225},{4,1},{2,1},{0,30},{0,226},{2,1},{0,170},{0,46},{8,1},{4,1},
	{2,1},{0,185},{0,155},{2,1},{0,227},{0,214},{4,1},{2,1},{0,109},{0,62},
	{2,1},{0,200},{0,140},{16,1},{8,1},{4,1},{2,1},{0,228},{0,78},{2,1},
	{0,215},{0,125},{4,1},{2,1},{0,229},{0,186},{2,1},{0,171},{0,94},{8,1},
	{4,1},{2,1},{0,201},{0,156},{2,1},{0,241},{0,31},{6,1},{4,1},{2,1},
	{0,240},{0,110},{0,242},{2,1},{0,47},{0,230},{38,1},{18,1},{8,1},{4,1},
	{2,1},{0,216},{0,243},{2,1},{0,63},{0,244},{6,1},{2,1},{0,79},{2,1},
	{0,141},{0,217},{2,1},{0,187},{0,202},{8,1},{4,1},{2,1},{0,172},{0,231},
	{2,1},{0,126},{0,245},{8,1},{4,1},{2,1},{0,157},{0,95},{2,1},{0,232},
	{0,142},{2,1},{0,246},{0,203},{34,1},{18,1},{10,1},{6,1},{4,1},{2,1},
	{0,15},{0,174},{0,111},{2,1},{0,188},{0,218},{4,1},{2,1},{0,173},{0,247},
	{2,1},{0,127},{0,233},{8,1},{4,1},{2,1},{0,158},{0,204},{2,1},{0,248},
	{0,143},{4,1},{2,1},{0,219},{0,189},{2,1},{0,234},{0,249},{16,1},{8,1},
	{4,1},{2,1},{0,159},{0,220},{2,1},{0,205},{0,235},{4,1},{2,1},{0,190},
	{0,250},{2,1},{0,175},{0,221},{14,1},{6,1},{4,1},{2,1},{0,236},{0,206},
	{0,251},{4,1},{2,1},{0,191},{0,237},{2,1},{0,222},{0,252},{6,1},{4,1},
	{2,1},{0,207},{0,253},{0,238},{4,1},{2,1},{0,223},{0,254},{2,1},{0,239},
	{0,255},
};

const unsigned char  ValTab16[511][2] = {
	{2,1},{0,0},{6,1},{2,1},{0,16},{2,1},{0,1},{0,17},{42,1},{8,1},
	{4,1},{2,1},{0,32},{0,2},{2,1},{0,33},{0,18},{10,1},{6,1},{2,1},
	{0,34},{2,1},{0,48},{0,3},{2,1},{0,49},{0,19},{10,1},{4,1},{2,1},
	{0,50},{0,35},{4,1},{2,1},{0,64},{0,4},{0,65},{6,1},{2,1},{0,20},
	{2,1},{0,51},{0,66},{4,1},{2,1},{0,36},{0,80},{2,1},{0,67},{0,52},
	{138,1},{40,1},{16,1},{6,1},{4,1},{2,1},{0,5},{0,21},{0,81},{4,1},
	{2,1},{0,82},{0,37},{4,1},{2,1},{0,68},{0,53},{0,83},{10,1},{6,1},
	{4,1},{2,1},{0,96},{0,6},{0,97},{2,1},{0,22},{0,98},{8,1},{4,1},
	{2,1},{0,38},{0,84},{2,1},{0,69},{0,99},{4,1},{2,1},{0,54},{0,112},
	{0,113},{40,1},{18,1},{8,1},{2,1},{0,23},{2,1},{0,7},{2,1},{0,85},
	{0,100},{4,1},{2,1},{0,114},{0,39},{4,1},{2,1},{0,70},{0,101},{0,115},
	{10,1},{6,1},{2,1},{0,55},{2,1},{0,86},{0,8},{2,1},{0,128},{0,129},
	{6,1},{2,1},{0,24},{2,1},{0,116},{0,71},{2,1},{0,130},{2,1},{0,40},
	{0,102},{24,1},{14,1},{8,1},{4,1},{2,1},{0,131},{0,56},{2,1},{0,117},
	{0,132},{4,1},{2,1},{0,72},{0,144},{0,145},{6,1},{2,1},{0,25},{2,1},
	{0,9},{0,118},{2,1},{0,146},{0,41},{14,1},{8,1},{4,1},{2,1},{0,133},
	{0,88},{2,1},{0,147},{0,57},{4,1},{2,1},{0,160},{0,10},{0,26},{8,1},
	{2,1},{0,162},{2,1},{0,103},{2,1},{0,87},{0,73},{6,1},{2,1},{0,148},
	{2,1},{0,119},{0,134},{2,1},{0,161},{2,1},{0,104},{0,149},{220,1},{126,1},
	{50,1},{26,1},{12,1},{6,1},{2,1},{0,42},{2,1},{0,89},{0,58},{2,1},
	{0,163},{2,1},{0,135},{0,120},{8,1},{4,1},{2,1},{0,164},{0,74},{2,1},
	{0,150},{0,105},{4,1},{2,1},{0,176},{0,11},{0,177},{10,1},{4,1},{2,1},
	{0,27},{0,178},{2,1},{0,43},{2,1},{0,165},{0,90},{6,1},{2,1},{0,179},
	{2,1},{0,166},{0,106},{4,1},{2,1},{0,180},{0,75},{2,1},{0,12},{0,193},
	{30,1},{14,1},{6,1},{4,1},{2,1},{0,181},{0,194},{0,44},{4,1},{2,1},
	{0,167},{0,195},{2,1},{0,107},{0,196},{8,1},{2,1},{0,29},{4,1},{2,1},
	{0,136},{0,151},{0,59},{4,1},{2,1},{0,209},{0,210},{2,1},{0,45},{0,211},
	{18,1},{6,1},{4,1},{2,1},{0,30},{0,46},{0,226},{6,1},{4,1},{2,1},
	{0,121},{0,152},{0,192},{2,1},{0,28},{2,1},{0,137},{0,91},{14,1},{6,1},
	{2,1},{0,60},{2,1},{0,122},{0,182},{4,1},{2,1},{0,76},{0,153},{2,1},
	{0,168},{0,138},{6,1},{2,1},{0,13},{2,1},{0,197},{0,92},{4,1},{2,1},
	{0,61},{0,198},{2,1},{0,108},{0,154},{88,1},{86,1},{36,1},{16,1},{8,1},
	{4,1},{2,1},{0,139},{0,77},{2,1},{0,199},{0,124},{4,1},{2,1},{0,213},
	{0,93},{2,1},{0,224},{0,14},{8,1},{2,1},{0,227},{4,1},{2,1},{0,208},
	{0,183},{0,123},{6,1},{4,1},{2,1},{0,169},{0,184},{0,212},{2,1},{0,225},
	{2,1},{0,170},{0,185},{24,1},{10,1},{6,1},{4,1},{2,1},{0,155},{0,214},
	{0,109},{2,1},{0,62},{0,200},{6,1},{4,1},{2,1},{0,140},{0,228},{0,78},
	{4,1},{2,1},{0,215},{0,229},{2,1},{0,186},{0,171},{12,1},{4,1},{2,1},
	{0,156},{0,230},{4,1},{2,1},{0,110},{0,216},{2,1},{0,141},{0,187},{8,1},
	{4,1},{2,1},{0,231},{0,157},{2,1},{0,232},{0,142},{4,1},{2,1},{0,203},
	{0,188},{0,158},{0,241},{2,1},{0,31},{2,1},{0,15},{0,47},{66,1},{56,1},
	{2,1},{0,242},{52,1},{50,1},{20,1},{8,1},{2,1},{0,189},{2,1},{0,94},
	{2,1},{0,125},{0,201},{6,1},{2,1},{0,202},{2,1},{0,172},{0,126},{4,1},
	{2,1},{0,218},{0,173},{0,204},{10,1},{6,1},{2,1},{0,174},{2,1},{0,219},
	{0,220},{2,1},{0,205},{0,190},{6,1},{4,1},{2,1},{0,235},{0,237},{0,238},
	{6,1},{4,1},{2,1},{0,217},{0,234},{0,233},{2,1},{0,222},{4,1},{2,1},
	{0,221},{0,236},{0,206},{0,63},{0,240},{4,1},{2,1},{0,243},{0,244},{2,1},
	{0,79},{2,1},{0,245},{0,95},{10,1},{2,1},{0,255},{4,1},{2,1},{0,246},
	{0,111},{2,1},{0,247},{0,127},{12,1},{6,1},{2,1},{0,143},{2,1},{0,248},
	{0,249},{4,1},{2,1},{0,159},{0,250},{0,175},{8,1},{4,1},{2,1},{0,251},
	{0,191},{2,1},{0,252},{0,207},{4,1},{2,1},{0,253},{0,223},{2,1},{0,254},
	{0,239},
};

const unsigned char ValTab24[512][2] = {
	{60,1},{8,1},{4,1},{2,1},{0,0},{0,16},{2,1},{0,1},{0,17},{14,1},
	{6,1},{4,1},{2,1},{0,32},{0,2},{0,33},{2,1},{0,18},{2,1},{0,34},
	{2,1},{0,48},{0,3},{14,1},{4,1},{2,1},{0,49},{0,19},{4,1},{2,1},
	{0,50},{0,35},{4,1},{2,1},{0,64},{0,4},{0,65},{8,1},{4,1},{2,1},
	{0,20},{0,51},{2,1},{0,66},{0,36},{6,1},{4,1},{2,1},{0,67},{0,52},
	{0,81},{6,1},{4,1},{2,1},{0,80},{0,5},{0,21},{2,1},{0,82},{0,37},
	{250,1},{98,1},{34,1},{18,1},{10,1},{4,1},{2,1},{0,68},{0,83},{2,1},
	{0,53},{2,1},{0,96},{0,6},{4,1},{2,1},{0,97},{0,22},{2,1},{0,98},
	{0,38},{8,1},{4,1},{2,1},{0,84},{0,69},{2,1},{0,99},{0,54},{4,1},
	{2,1},{0,113},{0,85},{2,1},{0,100},{0,70},{32,1},{14,1},{6,1},{2,1},
	{0,114},{2,1},{0,39},{0,55},{2,1},{0,115},{4,1},{2,1},{0,112},{0,7},
	{0,23},{10,1},{4,1},{2,1},{0,101},{0,86},{4,1},{2,1},{0,128},{0,8},
	{0,129},{4,1},{2,1},{0,116},{0,71},{2,1},{0,24},{0,130},{16,1},{8,1},
	{4,1},{2,1},{0,40},{0,102},{2,1},{0,131},{0,56},{4,1},{2,1},{0,117},
	{0,87},{2,1},{0,132},{0,72},{8,1},{4,1},{2,1},{0,145},{0,25},{2,1},
	{0,146},{0,118},{4,1},{2,1},{0,103},{0,41},{2,1},{0,133},{0,88},{92,1},
	{34,1},{16,1},{8,1},{4,1},{2,1},{0,147},{0,57},{2,1},{0,148},{0,73},
	{4,1},{2,1},{0,119},{0,134},{2,1},{0,104},{0,161},{8,1},{4,1},{2,1},
	{0,162},{0,42},{2,1},{0,149},{0,89},{4,1},{2,1},{0,163},{0,58},{2,1},
	{0,135},{2,1},{0,120},{0,74},{22,1},{12,1},{4,1},{2,1},{0,164},{0,150},
	{4,1},{2,1},{0,105},{0,177},{2,1},{0,27},{0,165},{6,1},{2,1},{0,178},
	{2,1},{0,90},{0,43},{2,1},{0,136},{0,179},{16,1},{10,1},{6,1},{2,1},
	{0,144},{2,1},{0,9},{0,160},{2,1},{0,151},{0,121},{4,1},{2,1},{0,166},
	{0,106},{0,180},{12,1},{6,1},{2,1},{0,26},{2,1},{0,10},{0,176},{2,1},
	{0,59},{2,1},{0,11},{0,192},{4,1},{2,1},{0,75},{0,193},{2,1},{0,152},
	{0,137},{67,1},{34,1},{16,1},{8,1},{4,1},{2,1},{0,28},{0,181},{2,1},
	{0,91},{0,194},{4,1},{2,1},{0,44},{0,167},{2,1},{0,122},{0,195},{10,1},
	{6,1},{2,1},{0,60},{2,1},{0,12},{0,208},{2,1},{0,182},{0,107},{4,1},
	{2,1},{0,196},{0,76},{2,1},{0,153},{0,168},{16,1},{8,1},{4,1},{2,1},
	{0,138},{0,197},{2,1},{0,92},{0,209},{4,1},{2,1},{0,183},{0,123},{2,1},
	{0,29},{0,210},{9,1},{4,1},{2,1},{0,45},{0,211},{2,1},{0,61},{0,198},
	{85,250},{4,1},{2,1},{0,108},{0,169},{2,1},{0,154},{0,212},{32,1},{16,1},
	{8,1},{4,1},{2,1},{0,184},{0,139},{2,1},{0,77},{0,199},{4,1},{2,1},
	{0,124},{0,213},{2,1},{0,93},{0,225},{8,1},{4,1},{2,1},{0,30},{0,226},
	{2,1},{0,170},{0,185},{4,1},{2,1},{0,155},{0,227},{2,1},{0,214},{0,109},
	{20,1},{10,1},{6,1},{2,1},{0,62},{2,1},{0,46},{0,78},{2,1},{0,200},
	{0,140},{4,1},{2,1},{0,228},{0,215},{4,1},{2,1},{0,125},{0,171},{0,229},
	{10,1},{4,1},{2,1},{0,186},{0,94},{2,1},{0,201},{2,1},{0,156},{0,110},
	{8,1},{2,1},{0,230},{2,1},{0,13},{2,1},{0,224},{0,14},{4,1},{2,1},
	{0,216},{0,141},{2,1},{0,187},{0,202},{74,1},{2,1},{0,255},{64,1},{58,1},
	{32,1},{16,1},{8,1},{4,1},{2,1},{0,172},{0,231},{2,1},{0,126},{0,217},
	{4,1},{2,1},{0,157},{0,232},{2,1},{0,142},{0,203},{8,1},{4,1},{2,1},
	{0,188},{0,218},{2,1},{0,173},{0,233},{4,1},{2,1},{0,158},{0,204},{2,1},
	{0,219},{0,189},{16,1},{8,1},{4,1},{2,1},{0,234},{0,174},{2,1},{0,220},
	{0,205},{4,1},{2,1},{0,235},{0,190},{2,1},{0,221},{0,236},{8,1},{4,1},
	{2,1},{0,206},{0,237},{2,1},{0,222},{0,238},{0,15},{4,1},{2,1},{0,240},
	{0,31},{0,241},{4,1},{2,1},{0,242},{0,47},{2,1},{0,243},{0,63},{18,1},
	{8,1},{4,1},{2,1},{0,244},{0,79},{2,1},{0,245},{0,95},{4,1},{2,1},
	{0,246},{0,111},{2,1},{0,247},{2,1},{0,127},{0,143},{10,1},{4,1},{2,1},
	{0,248},{0,249},{4,1},{2,1},{0,159},{0,175},{0,250},{8,1},{4,1},{2,1},
	{0,251},{0,191},{2,1},{0,252},{0,207},{4,1},{2,1},{0,253},{0,223},{2,1},
	{0,254},{0,239},
};

const unsigned char ValTab32[31][2] = {
	{2,1},{0,0},{8,1},{4,1},{2,1},{0,8},{0,4},{2,1},{0,1},{0,2},
	{8,1},{4,1},{2,1},{0,12},{0,10},{2,1},{0,3},{0,6},{6,1},{2,1},
	{0,9},{2,1},{0,5},{0,7},{4,1},{2,1},{0,14},{0,13},{2,1},{0,15},
	{0,11},
};

const unsigned char ValTab33[31][2] = {
	{16,1},{8,1},{4,1},{2,1},{0,0},{0,1},{2,1},{0,2},{0,3},{4,1},
	{2,1},{0,4},{0,5},{2,1},{0,6},{0,7},{8,1},{4,1},{2,1},{0,8},
	{0,9},{2,1},{0,10},{0,11},{4,1},{2,1},{0,12},{0,13},{2,1},{0,14},
	{0,15},
};

const unsigned char sfBandIndex_s[9][14] = {
	{0,4,8,12,18,24,32,42,56,74,100,132,174,192},
	{0,4,8,12,18,26,36,48,62,80,104,136,180,192},
	{0,4,8,12,18,26,36,48,62,80,104,134,174,192},
	{0,4,8,12,16,22,30,40,52,66,84,106,136,192},
	{0,4,8,12,16,22,28,38,50,64,80,100,126,192},
	{0,4,8,12,16,22,30,42,58,78,104,138,180,192},
	{0,4,8,12,18,26,36,48,62,80,104,134,174,192},
	{0,4,8,12,18,26,36,48,62,80,104,134,174,192},
	{0,8,16,24,36,52,72,96,124,160,162,164,166,192}
};

const int slen[2][16] = {
	 {0, 0, 0, 0, 3, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, 4},
	 {0, 1, 2, 3, 0, 1, 2, 3, 1, 2, 3, 1, 2, 3, 2, 3}
};

const int nr_of_sfb_block[6][3][4] = {
	{{ 6, 5, 5, 5} , { 9, 9, 9, 9} , { 6, 9, 9, 9}},
	{{ 6, 5, 7, 3} , { 9, 9,12, 6} , { 6, 9,12, 6}},
	{{11,10, 0, 0} , {18,18, 0, 0} , {15,18, 0, 0}},
	{{ 7, 7, 7, 0} , {12,12,12, 0} , { 6,15,12, 0}},
	{{ 6, 6, 6, 3} , {12, 9, 9, 6} , { 6,12, 9, 6}},
	{{ 8, 8, 5, 0} , {15,12, 9, 0} , { 6,18, 9, 0}}
};

const int sfBandIndex_l[9][23] = {
	{0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576},
	{0,6,12,18,24,30,36,44,54,66,80,96,114,136,162,194,232,278,330,394,464,540,576},
	{0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576},
	{0,4,8,12,16,20,24,30,36,44,52,62,74,90,110,134,162,196,238,288,342,418,576},
	{0,4,8,12,16,20,24,30,36,42,50,60,72,88,106,128,156,190,230,276,330,384,576},
	{0,4,8,12,16,20,24,30,36,44,54,66,82,102,126,156,194,240,296,364,448,550,576},
	{0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576},
	{0,6,12,18,24,30,36,44,54,66,80,96,116,140,168,200,238,284,336,396,464,522,576},
	{0,12,24,36,48,60,72,88,108,132,160,192,232,280,336,400,476,566,568,570,572,574,576}
};

const float two_to_negative_half_pow[] = {
	1.0000000000E+00, 7.0710678119E-01, 5.0000000000E-01, 3.5355339059E-01,
	2.5000000000E-01, 1.7677669530E-01, 1.2500000000E-01, 8.8388347648E-02,
	6.2500000000E-02, 4.4194173824E-02, 3.1250000000E-02, 2.2097086912E-02,
	1.5625000000E-02, 1.1048543456E-02, 7.8125000000E-03, 5.5242717280E-03,
	3.9062500000E-03, 2.7621358640E-03, 1.9531250000E-03, 1.3810679320E-03,
	9.7656250000E-04, 6.9053396600E-04, 4.8828125000E-04, 3.4526698300E-04,
	2.4414062500E-04, 1.7263349150E-04, 1.2207031250E-04, 8.6316745750E-05,
	6.1035156250E-05, 4.3158372875E-05, 3.0517578125E-05, 2.1579186438E-05,
	1.5258789062E-05, 1.0789593219E-05, 7.6293945312E-06, 5.3947966094E-06,
	3.8146972656E-06, 2.6973983047E-06, 1.9073486328E-06, 1.3486991523E-06,
	9.5367431641E-07, 6.7434957617E-07, 4.7683715820E-07, 3.3717478809E-07,
	2.3841857910E-07, 1.6858739404E-07, 1.1920928955E-07, 8.4293697022E-08,
	5.9604644775E-08, 4.2146848511E-08, 2.9802322388E-08, 2.1073424255E-08,
	1.4901161194E-08, 1.0536712128E-08, 7.4505805969E-09, 5.2683560639E-09,
	3.7252902985E-09, 2.6341780319E-09, 1.8626451492E-09, 1.3170890160E-09,
	9.3132257462E-10, 6.5854450798E-10, 4.6566128731E-10, 3.2927225399E-10
};

const int pretab[] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 3, 3, 3, 2, 0};

const float TAN12[16] = { 
	0, 0.26794919, 0.57735027, 1,
	1.73205081, 3.73205081, 9.9999999e10, -3.73205081,
	-1.73205081, -1, -0.57735027, -0.26794919,
	0, 0.26794919, 0.57735027, 1
};

const float io[2][32] = {
	 { 1.0000000000E+00, 8.4089641526E-01, 7.0710678119E-01, 5.9460355751E-01,
	   5.0000000001E-01, 4.2044820763E-01, 3.5355339060E-01, 2.9730177876E-01,
	   2.5000000001E-01, 2.1022410382E-01, 1.7677669530E-01, 1.4865088938E-01,
	   1.2500000000E-01, 1.0511205191E-01, 8.8388347652E-02, 7.4325444691E-02,
	   6.2500000003E-02, 5.2556025956E-02, 4.4194173826E-02, 3.7162722346E-02,
	   3.1250000002E-02, 2.6278012978E-02, 2.2097086913E-02, 1.8581361173E-02,
	   1.5625000001E-02, 1.3139006489E-02, 1.1048543457E-02, 9.2906805866E-03,
	   7.8125000006E-03, 6.5695032447E-03, 5.5242717285E-03, 4.6453402934E-03 },
	   
	 { 1.0000000000E+00, 7.0710678119E-01, 5.0000000000E-01, 3.5355339060E-01,
	   2.5000000000E-01, 1.7677669530E-01, 1.2500000000E-01, 8.8388347650E-02,
	   6.2500000001E-02, 4.4194173825E-02, 3.1250000001E-02, 2.2097086913E-02,
	   1.5625000000E-02, 1.1048543456E-02, 7.8125000002E-03, 5.5242717282E-03,
	   3.9062500001E-03, 2.7621358641E-03, 1.9531250001E-03, 1.3810679321E-03,
	   9.7656250004E-04, 6.9053396603E-04, 4.8828125002E-04, 3.4526698302E-04,
	   2.4414062501E-04, 1.7263349151E-04, 1.2207031251E-04, 8.6316745755E-05,
	   6.1035156254E-05, 4.3158372878E-05, 3.0517578127E-05, 2.1579186439E-05 }
};

const float cs[] = {
	 0.857492925712, 0.881741997318, 0.949628649103, 0.983314592492,
	 0.995517816065, 0.999160558175, 0.999899195243, 0.999993155067
};

const float ca[] = {
	-0.5144957554270, -0.4717319685650, -0.3133774542040, -0.1819131996110,
	-0.0945741925262, -0.0409655828852, -0.0141985685725, -0.00369997467375
};

const float win[4][36] = {
 { -1.6141214951E-02, -5.3603178919E-02, -1.0070713296E-01, -1.6280817573E-01,
   -4.9999999679E-01, -3.8388735032E-01, -6.2061144372E-01, -1.1659756083E+00,
   -3.8720752656E+00, -4.2256286556E+00, -1.5195289984E+00, -9.7416483388E-01,
   -7.3744074053E-01, -1.2071067773E+00, -5.1636156596E-01, -4.5426052317E-01,
   -4.0715656898E-01, -3.6969460527E-01, -3.3876269197E-01, -3.1242222492E-01,
   -2.8939587111E-01, -2.6880081906E-01, -5.0000000266E-01, -2.3251417468E-01,
   -2.1596714708E-01, -2.0004979098E-01, -1.8449493497E-01, -1.6905846094E-01,
   -1.5350360518E-01, -1.3758624925E-01, -1.2103922149E-01, -2.0710679058E-01,
   -8.4752577594E-02, -6.4157525656E-02, -4.1131172614E-02, -1.4790705759E-02 },

 { -1.6141214951E-02, -5.3603178919E-02, -1.0070713296E-01, -1.6280817573E-01,
   -4.9999999679E-01, -3.8388735032E-01, -6.2061144372E-01, -1.1659756083E+00,
   -3.8720752656E+00, -4.2256286556E+00, -1.5195289984E+00, -9.7416483388E-01,
   -7.3744074053E-01, -1.2071067773E+00, -5.1636156596E-01, -4.5426052317E-01,
   -4.0715656898E-01, -3.6969460527E-01, -3.3908542600E-01, -3.1511810350E-01,
   -2.9642226150E-01, -2.8184548650E-01, -5.4119610000E-01, -2.6213228100E-01,
   -2.5387916537E-01, -2.3296291359E-01, -1.9852728987E-01, -1.5233534808E-01,
   -9.6496400054E-02, -3.3423828516E-02, 0.0000000000E+00, 0.0000000000E+00,
   0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00 },

 { -4.8300800645E-02, -1.5715656932E-01, -2.8325045177E-01, -4.2953747763E-01,
   -1.2071067795E+00, -8.2426483178E-01, -1.1451749106E+00, -1.7695290101E+00,
   -4.5470225061E+00, -3.4890531002E+00, -7.3296292804E-01, -1.5076514758E-01,
   0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00,
   0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00,
   0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00,
   0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00,
   0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00,
   0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00 },

 { 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00, 0.0000000000E+00,
   0.0000000000E+00, 0.0000000000E+00, -1.5076513660E-01, -7.3296291107E-01,
   -3.4890530566E+00, -4.5470224727E+00, -1.7695290031E+00, -1.1451749092E+00,
   -8.3137738100E-01, -1.3065629650E+00, -5.4142014250E-01, -4.6528974900E-01,
   -4.1066990750E-01, -3.7004680800E-01, -3.3876269197E-01, -3.1242222492E-01,
   -2.8939587111E-01, -2.6880081906E-01, -5.0000000266E-01, -2.3251417468E-01,
   -2.1596714708E-01, -2.0004979098E-01, -1.8449493497E-01, -1.6905846094E-01,
   -1.5350360518E-01, -1.3758624925E-01, -1.2103922149E-01, -2.0710679058E-01,
   -8.4752577594E-02, -6.4157525656E-02, -4.1131172614E-02, -1.4790705759E-02 }
};

const float SynthesisFilter_cosCacheTable[5][16] = {
	{0.70710677, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{0.5411961, 1.306563, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{0.5097956, 0.6013449, 0.8999762, 2.5629156, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{0.5024193, 0.5224986, 0.56694406, 0.6468218, 0.7881546, 1.0606776, 1.7224472, 5.1011486, 0, 0, 0, 0, 0, 0, 0, 0},
	{0.500603, 0.50547093, 0.5154473, 0.5310426, 0.5531039, 0.582935, 0.6225041, 0.6748083, 0.7445363, 0.8393496, 0.9725682, 1.1694399, 1.4841646, 2.057781, 3.4076085, 10.190008}
};

const float SynthesisFilter_d16[32][16] = {
	{0.0, -14.4699135, 106.27899, -229.02374, 1016.3864, -2571.1533, 3280.1787, -18705.602, 37441.14, 18705.602, 3280.1787, 2571.1533, 1016.3864, 229.02374, 106.27899, 14.4699135},
	{-0.49896932, -15.467819, 108.7738, -258.96152, 997.9248, -2752.7756, 2973.317, -19627.186, 37418.188, 17783.02, 3559.5977, 2389.032, 1029.3594, 200.08391, 103.78417, 12.973039},
	{-0.49896932, -17.463697, 110.769646, -289.89716, 973.9746, -2933.4, 2638.5132, -20545.275, 37350.33, 16860.44, 3812.0728, 2207.9087, 1037.8418, 173.13995, 100.79039, 11.9751},
	{-0.49896932, -18.960571, 112.266556, -321.83075, 944.5358, -3112.0286, 2275.7676, -21458.377, 37237.562, 15940.352, 4037.6038, 2027.2842, 1041.3345, 146.69495, 97.79664, 10.478225},
	{-0.49896932, -20.457447, 113.26446, -354.76227, 909.1095, -3287.6633, 1884.082, -22363.994, 37079.395, 15024.756, 4237.1885, 1848.6558, 1040.3367, 121.74684, 94.80286, 9.480286},
	{-0.49896932, -22.453323, 113.76343, -388.6917, 867.6956, -3460.3042, 1464.4546, -23260.13, 36877.312, 14115.147, 4410.8276, 1672.023, 1035.3469, 98.29558, 91.310104, 8.4823475},
	{-0.49896932, -24.44917, 113.76343, -423.12012, 820.2942, -3627.9556, 1016.3864, -24144.791, 36631.324, 13213.522, 4560.0176, 1498.883, 1026.3657, 76.341255, 87.81739, 7.983411},
	{-0.99793863, -26.445013, 113.26446, -458.54645, 765.9073, -3790.6174, 539.8773, -25016.479, 36341.926, 12321.378, 4684.758, 1328.7368, 1013.8916, 55.384842, 84.32463, 6.985472},
	{-0.99793863, -28.939827, 111.767586, -494.47174, 705.53284, -3946.7925, 34.92736, -25872.697, 36009.617, 11440.709, 4786.0474, 1162.5824, 998.42377, 35.9253, 80.33295, 6.4865026},
	{-0.99793863, -31.43464, 110.270676, -530.896, 638.6719, -4095.9824, -497.96445, -26711.453, 35635.895, 10572.515, 4864.8833, 1000.9186, 978.96423, 17.962633, 76.840225, 5.488597},
	{-0.99793863, -33.929455, 107.27693, -567.32025, 564.3265, -4236.69, -1058.7982, -27531.748, 35221.758, 9718.79, 4921.266, 844.2444, 957.50885, 0.99793863, 73.34747, 4.989628},
	{-1.4968752, -36.424267, 103.78417, -603.7445, 483.99353, -4368.416, -1646.5759, -28330.088, 34767.203, 8881.032, 4957.1914, 692.5598, 933.0597, -14.4699135, 69.35578, 4.4906583},
	{-1.4968752, -39.41802, 99.79249, -640.16876, 396.17618, -4489.6636, -2261.7966, -29105.975, 34274.727, 8060.738, 4972.659, 546.36383, 906.6147, -28.440857, 65.86303, 3.991689},
	{-1.9958445, -42.4118, 94.30389, -676.593, 301.87225, -4599.9346, -2902.9634, -29856.912, 33744.33, 7258.9053, 4969.1665, 406.1554, 877.67487, -41.413864, 62.37031, 3.4927523},
	{-1.9958445, -45.405586, 88.31635, -712.5183, 200.58289, -4698.23, -3569.5771, -30580.906, 33178.008, 6476.532, 4947.711, 271.9345, 847.23816, -52.890026, 58.37859, 3.4927523},
	{-2.494814, -48.39937, 81.33089, -747.4457, 92.308044, -4782.5547, -4261.1387, -31276.959, 32577.256, 5715.6143, 4908.792, 143.70116, 815.30457, -63.368217, 55.384842, 2.9937832},
	{-2.494814, -51.892086, 72.8485, -781.8741, -22.453323, -4853.407, -4977.15, -31943.074, 31943.074, 4977.15, 4853.407, 22.453323, 781.8741, -72.8485, 51.892086, 2.494814},
	{-2.9937832, -55.384842, 63.368217, -815.30457, -143.70116, -4908.792, -5715.6143, -32577.256, 31276.959, 4261.1387, 4782.5547, -92.308044, 747.4457, -81.33089, 48.39937, 2.494814},
	{-3.4927523, -58.37859, 52.890026, -847.23816, -271.9345, -4947.711, -6476.532, -33178.008, 30580.906, 3569.5771, 4698.23, -200.58289, 712.5183, -88.31635, 45.405586, 1.9958445},
	{-3.4927523, -62.37031, 41.413864, -877.67487, -406.1554, -4969.1665, -7258.9053, -33744.33, 29856.912, 2902.9634, 4599.9346, -301.87225, 676.593, -94.30389, 42.4118, 1.9958445},
	{-3.991689, -65.86303, 28.440857, -906.6147, -546.36383, -4972.659, -8060.738, -34274.727, 29105.975, 2261.7966, 4489.6636, -396.17618, 640.16876, -99.79249, 39.41802, 1.4968752},
	{-4.4906583, -69.35578, 14.4699135, -933.0597, -692.5598, -4957.1914, -8881.032, -34767.203, 28330.088, 1646.5759, 4368.416, -483.99353, 603.7445, -103.78417, 36.424267, 1.4968752},
	{-4.989628, -73.34747, -0.99793863, -957.50885, -844.2444, -4921.266, -9718.79, -35221.758, 27531.748, 1058.7982, 4236.69, -564.3265, 567.32025, -107.27693, 33.929455, 0.99793863},
	{-5.488597, -76.840225, -17.962633, -978.96423, -1000.9186, -4864.8833, -10572.515, -35635.895, 26711.453, 497.96445, 4095.9824, -638.6719, 530.896, -110.270676, 31.43464, 0.99793863},
	{-6.4865026, -80.33295, -35.9253, -998.42377, -1162.5824, -4786.0474, -11440.709, -36009.617, 25872.697, -34.92736, 3946.7925, -705.53284, 494.47174, -111.767586, 28.939827, 0.99793863},
	{-6.985472, -84.32463, -55.384842, -1013.8916, -1328.7368, -4684.758, -12321.378, -36341.926, 25016.479, -539.8773, 3790.6174, -765.9073, 458.54645, -113.26446, 26.445013, 0.99793863},
	{-7.983411, -87.81739, -76.341255, -1026.3657, -1498.883, -4560.0176, -13213.522, -36631.324, 24144.791, -1016.3864, 3627.9556, -820.2942, 423.12012, -113.76343, 24.44917, 0.49896932},
	{-8.4823475, -91.310104, -98.29558, -1035.3469, -1672.023, -4410.8276, -14115.147, -36877.312, 23260.13, -1464.4546, 3460.3042, -867.6956, 388.6917, -113.76343, 22.453323, 0.49896932},
	{-9.480286, -94.80286, -121.74684, -1040.3367, -1848.6558, -4237.1885, -15024.756, -37079.395, 22363.994, -1884.082, 3287.6633, -909.1095, 354.76227, -113.26446, 20.457447, 0.49896932},
	{-10.478225, -97.79664, -146.69495, -1041.3345, -2027.2842, -4037.6038, -15940.352, -37237.562, 21458.377, -2275.7676, 3112.0286, -944.5358, 321.83075, -112.266556, 18.960571, 0.49896932},
	{-11.9751, -100.79039, -173.13995, -1037.8418, -2207.9087, -3812.0728, -16860.44, -37350.33, 20545.275, -2638.5132, 2933.4, -973.9746, 289.89716, -110.769646, 17.463697, 0.49896932},
	{-12.973039, -103.78417, -200.08391, -1029.3594, -2389.032, -3559.5977, -17783.02, -37418.188, 19627.186, -2973.317, 2752.7756, -997.9248, 258.96152, -108.7738, 15.467819, 0.49896932}
};

const float io_v2[64] = {
	   1.0000000000E+00, 8.4089641526E-01, 7.0710678119E-01, 5.9460355751E-01,
	   5.0000000001E-01, 4.2044820763E-01, 3.5355339060E-01, 2.9730177876E-01,
	   2.5000000001E-01, 2.1022410382E-01, 1.7677669530E-01, 1.4865088938E-01,
	   1.2500000000E-01, 1.0511205191E-01, 8.8388347652E-02, 7.4325444691E-02,
	   6.2500000003E-02, 5.2556025956E-02, 4.4194173826E-02, 3.7162722346E-02,
	   3.1250000002E-02, 2.6278012978E-02, 2.2097086913E-02, 1.8581361173E-02,
	   1.5625000001E-02, 1.3139006489E-02, 1.1048543457E-02, 9.2906805866E-03,
	   7.8125000006E-03, 6.5695032447E-03, 5.5242717285E-03, 4.6453402934E-03,
	   
	   1.0000000000E+00, 7.0710678119E-01, 5.0000000000E-01, 3.5355339060E-01,
	   2.5000000000E-01, 1.7677669530E-01, 1.2500000000E-01, 8.8388347650E-02,
	   6.2500000001E-02, 4.4194173825E-02, 3.1250000001E-02, 2.2097086913E-02,
	   1.5625000000E-02, 1.1048543456E-02, 7.8125000002E-03, 5.5242717282E-03,
	   3.9062500001E-03, 2.7621358641E-03, 1.9531250001E-03, 1.3810679321E-03,
	   9.7656250004E-04, 6.9053396603E-04, 4.8828125002E-04, 3.4526698302E-04,
	   2.4414062501E-04, 1.7263349151E-04, 1.2207031251E-04, 8.6316745755E-05,
	   6.1035156254E-05, 4.3158372878E-05, 3.0517578127E-05, 2.1579186439E-05
};

typedef struct huffcodetabStruct{//size = 16 bytes?
	bool isSpecial;
	char xlen; // max. x-index+
	char ylen; // max. y-index+
	char linbits; // number of linbits
	
	//int** val;//[][]; // decoder tree
	const unsigned char (*val)[2];
	char treelen; // length of decoder tree
} huffcodetab;

const huffcodetab htArr[34] = {
	{.isSpecial = false, .xlen = 0, .ylen = 0, .linbits = 0, .val = ValTab_dummy, .treelen = 0},
	{.isSpecial = false, .xlen = 2, .ylen = 2, .linbits = 0, .val = ValTab1, .treelen = 1},
	{.isSpecial = false, .xlen = 3, .ylen = 3, .linbits = 0, .val = ValTab2, .treelen = 1},
	{.isSpecial = false, .xlen = 3, .ylen = 3, .linbits = 0, .val = ValTab3, .treelen = 1},
	{.isSpecial = false, .xlen = 0, .ylen = 0, .linbits = 0, .val = ValTab_dummy, .treelen = 0},
	{.isSpecial = false, .xlen = 4, .ylen = 4, .linbits = 0, .val = ValTab5, .treelen = 1},
	{.isSpecial = false, .xlen = 4, .ylen = 4, .linbits = 0, .val = ValTab6, .treelen = 1},
	{.isSpecial = false, .xlen = 6, .ylen = 6, .linbits = 0, .val = ValTab7, .treelen = 1},
	{.isSpecial = false, .xlen = 6, .ylen = 6, .linbits = 0, .val = ValTab8, .treelen = 1},
	{.isSpecial = false, .xlen = 6, .ylen = 6, .linbits = 0, .val = ValTab9, .treelen = 1},
	{.isSpecial = false, .xlen = 8, .ylen = 8, .linbits = 0, .val = ValTab10, .treelen = 1},
	{.isSpecial = false, .xlen = 8, .ylen = 8, .linbits = 0, .val = ValTab11, .treelen = 1},
	{.isSpecial = false, .xlen = 8, .ylen = 8, .linbits = 0, .val = ValTab12, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 0, .val = ValTab13, .treelen = 1},
	{.isSpecial = false, .xlen = 0, .ylen = 0, .linbits = 0, .val = ValTab_dummy, .treelen = 0},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 0, .val = ValTab15, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 1, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 2, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 3, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 4, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 6, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 8, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 10, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 13, .val = ValTab16, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 4, .val = ValTab24, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 5, .val = ValTab24, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 6, .val = ValTab24, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 7, .val = ValTab24, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 8, .val = ValTab24, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 9, .val = ValTab24, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 11, .val = ValTab24, .treelen = 1},
	{.isSpecial = false, .xlen = 16, .ylen = 16, .linbits = 13, .val = ValTab24, .treelen = 1},
	{.isSpecial = true, .xlen = 1, .ylen = 16, .linbits = 0, .val = ValTab32, .treelen = 1},
	{.isSpecial = true, .xlen = 1, .ylen = 16, .linbits = 0, .val = ValTab33, .treelen = 1}
};



typedef struct gr_info_s_Struct{//size = 40 bytes?
	int part2_3_length;
	int big_values;
	int global_gain;
	int	scalefac_compress;
	char window_switching_flag;
	char block_type;
	char mixed_block_flag;
	char table_select[3];
	char subblock_gain[3];
	char region0_count;
	char region1_count;
	int preflag;
	char scalefac_scale;
	char count1table_select;
} gr_info_s;

typedef struct Mp3InstanceStruct{//size = 26936 bytes
	int cachedHeader;
	
	int sample_wp1;
	int sample_wp2;

	float v1[1024];
	float v2[1024];
	
	char si_ch_scfsi[4*2];
	gr_info_s si_ch_gr[2*2];

	char is_pos[576];
	char is_ratio[576];
	int scalefac0_l[23];
	int scalefac0_s[3][13];
	int scalefac1_l[23];
	int scalefac1_s[3][13];
	
	int frame_start;
	
	char  k       [2][SB_LIMIT*SS_LIMIT];//SB_LIMIT*SS_LIMIT = 576
	float prevblck[2][SB_LIMIT*SS_LIMIT];
	float ro      [2][SB_LIMIT][SS_LIMIT];
	float lr      [2][SB_LIMIT][SS_LIMIT];
	
	
	char buf[MAX_DATAPOOL_SIZE];//=511+1420=1931 bytes
	int bufReadPointer;
	int bufWritePointer;
	
	bool isStereo;
} Mp3Instance;

class MP3Parser {
	private:
		Mp3Instance* instance;
	public:
		bool isStereo;
		int samplingFrequency;
		int lastFrameSampleCount;
		
		MP3Parser();
		~MP3Parser();
		//void end();
		char* runDecode(LinkedList* dataBlocks, int* errorIdOutput);
};
#endif
